## 凯乐士WMS入库介绍

在凯乐士WMS中，完整的入库有5个单据步骤，分别是

* 采购订单，英文名为 Purchase Order，简写为：**po**
* 预期到货通知单，英文名为：Advance Shipping Notice，简写为: **asn**
* 收货单，英文名为：Receiving Report，因为他上接 ASN 单据，因此系统内简写为: **receasn**
* 入库前质检单，英文名为: Quality Control Report，系统简写为: **qc**
* 上架单，英文名为:Putaway Order，系统简写为: **putaway**
* 入库后抽检单，英文名为: Sampling Check Report，系统简写为: **sc**

这些步骤都会有对应的单据表，大部分类型的单据表都会分为：单据抬头（又称为单据、单据主表，表名称以 _master 结尾）、抬头中记录总体单据状态；单据明细（又称为单据详情，表名称以 _details结尾）明细中记录多行商品、数量、状态、动作；历史表（又称为结转、转历史，表名称以 _his结尾），有些表因为数据量过多造成系统性能问题，所以当达成某些数据达到某种状态之后会转移到历史表；

每个单据主表都有一个以 _no 结尾的字段，他们是具有唯一单据号而存在的字符串，比如 po_no / asn_no / receipt_no / qc_no / sc_no 他们在主表中都作为主键而存在；

每个单据明细表都会有一个以 _line_no 结尾的字段，他们是以1开始的序号而存在，比如 po_line_no / asn_line_no / rece_asn_line_no / qc_line_no / put_line_no / sc_line_no，一般情况下以单据字段(_no结尾的字段)+单据行(_line_no结尾的字段)作为明细表的联合主键；

下面，我列举一下每种单据的表名称：

* 采购订单 po 相关的表: doc_po_master,doc_po_details；
* 预期到货通知单 asn 相关的表: doc_asn_master,doc_asn_details, doc_asn_master_his, doc_asn_details_his；
* 收货表 receasn 相关的表: doc_receasn_master,doc_receasn_details, doc_receasn_details_his, doc_receasn_master_his；
* 质检表 qc 相关的表: doc_qc_master,doc_qc_details;
* 上架 putaway 相关的表: doc_putaway_details, doc_putaway_details_his;
* 抽检表 sc 相关的表: doc_sc_details,doc_sc_master；

在不同的项目中，有可能会省略掉某些步骤，比如有的项目不需要采购订单，ERP直接下传asn表，因此没有 po 数据；比如有的项目不需要质检，直接从收货(receasn)生成上架单(putaway)，所以没有 qc 步骤；有的项目不需要抽检，所以没有 sc 步骤；这需要根据项目的特性进行灵活定制；入库必须有的步骤是：asn、receasn、putaway

表关系：

* 一个 po 单，对应多个 asn 数据;
* 一个 asn 单可能多次收货，对应多个 receasn 单;
* 一个 receasn 单可能存在多次质检，生成一个或多个 qc 单；也可能不对应qc单;
* 一个 receasn 单可能分配到不同上架货位，生成一个或多个putaway单;也可能不生成putaway单;
* 一个 qc 单可能分配到不同的货位多次上架，生成一个或多个 putaway 单数据;
* sc比较例外，他属于入库之后根据客户要求发起的抽检，可以关联单据,也可以不关联单据，因此他也有put_line_no / rece_asn_line_no 允许为null;
* doc_po_master（采购单抬头）主键:po_no（采购单号）;
* doc_po_details（采购单明细）主键:po_no（采购单号）+po_line_no（采购订单行号）;
* doc_asn_master（预期到货通知单抬头）主键:asn_no(通知单号), 外键: ref_po_no 关联到 doc_po_master.po_no;
* doc_asn_details（预期到货通知单明细）主键:asn_no(通知单号) + asn_line_no(入库单行号);外键: ref_po_no + ref_po_line_no;
* doc_receasn_master（收货单抬头）主键:receipt_no(收货单号), 外键: asn_no 关联到 doc_asn_master.asn_no;
* doc_receasn_details（收货单明细）主键:receipt_no(收货单号) + rece_asn_line_no(收货单行号)，外键: asn_no + asn_line_no 关联到 doc_asn_details.asn_no + doc_asn_details.asn_line_no;
* doc_qc_master（质检单抬头）主键:qc_no（质检单号）, 外键 receipt_no 关联到 doc_receasn_master.receipt_no;
* doc_qc_details（质检单明细）主键:qc_no（质检单号）+qc_line_no（质检单行号）, 外键 rece_asn_line_no 关联到 doc_receasn_details.rece_asn_line_no，另外他还会记录生成的上架单号 put_line_no, 因为设计问题丢了个receipt_no;
* doc_putaway_details（上架单）主键:receipt_no(收货单号)+put_line_no(上架单行号), 外键 receipt_no 关联到 doc_receasn_master.receipt_no;
* doc_sc_master（抽检单抬头）主键:sc_no(抽检单号);
* doc_sc_details（抽检单明细）主键:sc_no(抽检单号)+sc_line_no(抽检单行号);
* po抬头和po明细可以省略;入库流程并不是一定会存在po数据，ERP直接下传数据生成ASN单据数据是可以的；
* asn抬头和asn明细不能省略，任何入库流程都必须有asn单据和asn明细数据;
* asn抬头关联po单抬头；asn明细关联po单明细；但这个关联是可以没有的，关联字段可以为null;
* receasn抬头和receasn明细不能省略，任何入库流程都必须有receasn单据和receasn明细数据;
* receasn抬头关联asn抬头；receasn明细关联asn明细；这个关联必须存在，关联字段不允许为null;
* qc抬头和qc明细可以省略，入库流程并不是一定会存在qc抬头和qc明细数据；
* qc抬头关联receasn抬头；qc明细行关联receasn明细行；这个关联必须存在，关联字段不允许为null;
* putaway明细不能省略，任何记录入库上架改变库存的动作，都必须存在putaway明细数据，putaway没有抬头表，只有明细表；
* 在收货入库的场景中，putaway明细必须关联receasn明细，putaway还明细必须关联asn明细；
* putaway数据一定会关联receasn明细，在空箱入库过程中，可能不关联asn明细；
* sc抬头和sc明细可以省略，当项目没有抽检业务，或者抽检业务由移库作业实现，可能项目中没有抽检数据;

下面是表格描述详情


## 数据库设计

### doc_po_master

采购订单主表（又称为采购单主表、采购单、采购记录、po、po单、po抬头、po主表），是由上游ERP系统下传至WMS采购订单表，开启WMS入库流程

主键：po_no (采购单号)

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、采购单号。
* **类型与状态信息**：采购订单类型、订单类型、订单状态、审核状态等，提供了关于采购订单当前状态和类型的概览。
* **时间信息**：日期、预到货开始/结束时间、到货时间、启动时间等，记录了与采购订单相关的各个时间点。
* **物流与运输信息**：运输方式、车型、车牌号、司机、装货地、卸货地、交货地、启运地、目的地等，描述了货物的物流详情。
* **供应商与承运人信息**：供应商ID及相关联系信息、承运人ID及相关联系信息，关联了具体的业务伙伴，并包含结算和付款方式等财务信息。
* **用户自定义字段**：多个用户自定义字段（如udf1, udf2, udf3），允许根据具体业务需求添加额外信息。
* **温度控制信息**：温控方式、启运温度、运输温度、到货温度等，适用于需要温控的货物运输。
* **创建和更新信息**：创建者、建立时间、修改者、更新时间，记录了数据的创建和维护历史。


### doc_po_details

采购订单明细表（又称为：采购单明细表、采购明细、采购详情、采购单详情、po详情、po明细、po行），是由上游ERP系统的采购订单明细下传至WMS采购订单明细表，开启WMS入库流程

主键:po_no（采购单号）+po_line_no（采购订单行号）

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、采购单号、采购单行号。
* **状态信息**：采购订单行状态，描述了每一条目在采购订单中的当前状态。
* **产品和包装信息**：商品ID、包装ID、包装单位类型、包装计量规格、包装单位、收货单位等，提供了关于具体商品及其包装详情的信息。
* **数量和完成情况**：订单数量（主单位及收货单位）、收货数量（主单位及收货单位）、已完成数量（按主单位和收货单位），记录了货物的数量及其完成状态。
* **时间与财务信息**：收货时间、单价、金额等，包括了货物接收的时间点及相关财务数据。
* **超额收货信息**：允许超额收货、超额收货百分比，支持灵活处理超出订单数量的情况。
* **批次属性信息**：多个批属性字段（如lot01至lot15），允许对货物进行更详细的分类和跟踪。
* **用户自定义及其他信息**：多个用户自定义字段（如udf1, udf2, udf3, udf4）以及备注字段，支持根据业务需求添加额外信息。
* **创建和更新信息**：创建者、建立时间、修改者、更新时间，记录了数据的创建和维护历史。


### doc_asn_master

预期到货通知单主表（又称为：预期到货通知单、通知单、入库单、通知单抬头、通知单主表、asn、asn单、asn抬头），用来记录预期到货通知单数据

主键:asn_no(通知单号)

外键: ref_po_no 关联到 doc_po_master.po_no

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、通知单号。
* **状态和类型信息**：ASN类型、ASN状态、审核状态、质检状态等，提供了关于ASN当前状态和类型的概览。
* **时间信息**：日期、预到货开始/结束时间、到货时间、启动时间等，记录了与ASN相关的各个时间点。
* **物流和运输信息**：调拨出库单号、优先级、运输方式、车型、车牌号、司机、装货地、卸货地等，描述了货物的物流详情。
* **供应商和承运人信息**：供应商ID及相关联系信息、承运人ID及相关联系信息，关联了具体的业务伙伴。
* **结算信息**：月台ID、包装耗材、结算方式、付款方式等，涵盖了仓储和财务相关的信息。
* **用户自定义字段**：多个用户自定义字段（如udf1, udf2, udf3），允许根据具体业务需求添加额外信息。
* **其他附加信息**：温度控制、批次确认、处理意见等特殊字段。


### doc_asn_details

预期到货通知单明细表（又称为：预期到货通知单明细、通知单详情、通知单明细、入库单明细、入库明细、asn明细、asn详情、asn行、asn detail、asn item），用来记录预期到货通知单详情数据

主键:asn_no(通知单号) + asn_line_no(入库单行号)

外键1: ref_po_no + ref_po_line_no 关联到 doc_po_details.po_no + doc_po_details.po_line_no

外键2: asn_no 关联到 doc\_asn\_master.asn_no

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、采购单号、采购单行号

* **状态信息**：审核状态、ASN 行状态、冻结状态、质检状态等，反映货物在入库流程中的当前状态。
* **产品和包装信息**：商品ID、包装ID、包装单位类型、包装计量规格等，描述了具体的商品及其包装详情。
* **采购和计划信息**：采购订单编号、采购订单行号、计划库位ID等，关联了与该货物相关的采购信息。
* **数量和质量信息**：预期数量、收货数量、合格数量、不合格数量等，记录了货物的数量及质量状况。
* **财务信息**：单价、金额等，涉及货物的价值信息。
* **批次和属性信息**：批属性规则ID及其多个批属性字段，以及用户自定义字段，允许对货物进行更详细的分类和跟踪。


### doc_receasn_master

收货单主表（又称为：收货单、receasn单、receasn抬头、receipt、receipt单、receipt抬头），用来记录收货单数据

主键:asn_no(通知单号)+receipt_no(收货单号)

外键: asn_no 关联到 doc_asn_master.asn_no

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、通知单号。
* **状态和类型信息**：收货状态、订单类型、ASN类型，提供了关于收货项目当前状态和类型的概览。
* **时间信息**：日期、起运时间、到货时间等字段，记录了货物从发货到接收的时间线。
* **物流信息**：到货方式、到货凭证、发货地点、运输单位等，描述了货物的物流详情。
* **供应商信息**：供应商ID，关联了具体的供应商。
* **创建和更新信息**：创建者、建立时间、修改者、更新时间，记录了数据的创建和维护历史。


### doc_receasn_details

收货单明细表（又称为：收货明细、收货行、收货详情、receasn明细、receasn详情、receasn行、receipt明细、receipt详情、receipt行、receipt item、receasn item、receipt detail、receipt item），用来记录收货单的详情数据

主键:receipt_no(收货单号) + rece_asn_line_no(收货单行号)

外键: asn_no + asn_line_no 关联到 doc_asn_details.asn_no + doc_asn_details.asn_line_no

外键2: receipt_no 关联到 doc\_receasn\_master.receipt_no

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、收货单号、收货单行号、通知单号、通知单行号。
* **状态和类型信息**：ASN行状态、质检状态、质检结论、冻结状态等，描述了货物在入库流程中的当前状态。
* **产品和包装信息**：商品ID、包装ID、包装单位类型、包装计量规格、包装单位、收货单位等，提供了关于具体商品及其包装详情的信息。
* **数量和质量信息**：收货数量（主单位及收货单位）、破损数量、冻结数量、拒收数量等，记录了货物的数量及质量状况。
* **时间与人员信息**：收货时间、收货人等，记录了货物接收的时间点及相关负责人。
* **财务信息**：单价、金额等，涉及货物的价值信息。
* **批次和属性信息**：批属性ID及其多个批属性字段（如lot01至lot15），允许对货物进行更详细的分类和跟踪。
* **库位信息**：计划库位ID、收货库位ID、上架区域、库区ID、库位ID等，关联了货物存储的具体位置。
* **物流和运输信息**：运输方式、温控方式、冷藏品温度等，描述了货物的物流详情。
* **用户自定义及其他信息**：多个用户自定义字段（如is\_wrapping\_film是否裹膜、is\_change\_box是否拆箱等），以及一些特殊标记字段（如是否允许原箱上架、托盘容量等），支持更灵活的业务需求。


### doc_qc_master

入库质检单主表（又称为：质检单、质检单主表、质检单抬头、qc、qc单、qc抬头），用来记录质检单据数据

主键:qc_no（质检单号）

外键 receipt_no 关联到 doc_receasn_master.receipt_no

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、质检单号、收货单号
* **类型与状态信息**：质检类型、质检单状态，描述了质检单的种类及其当前的状态。
* **时间信息**：日期字段，记录了质检单创建的时间点。
* **参考和源单信息**：多个参考信息字段（qc\_reference1至qc\_reference3）、源单类型、源单号、源单编号以及源收货单号，提供了质检单与其他业务单据之间的联系。
* **用户自定义字段**：多个用户自定义字段（如udf1, udf2, udf3），允许根据具体业务需求添加额外信息。
* **创建和更新信息**：创建者、建立时间、修改者、更新时间，记录了数据的创建和维护历史。


### doc_qc_details

入库质检明细表（又称为：质检明细、质检详情、质检行、qc明细、qc详情、qc行、qc detail、qc item），用来记录质检单据明细数据

主键:qc_no（质检单号）+qc_line_no（质检单行号）

外键:rece_asn_line_no 关联到 doc_receasn_details.rece_asn_line_no，另外他还会记录生成的上架单号 put_line_no,因为设计问题丢了个receipt_no

外键2: qc_no 关联到 doc\_qc\_master.qc_no

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、质检单号、质检单行号、收货单号、收货单行号
* **状态信息**：行状态，描述了每一条目在质检通知单中的当前状态。
* **数量信息**：预期数量、应检数量、抽检数量、实检数量、合格数量、不合格数量、拒收数量，记录了关于质检过程中不同阶段的数量数据。
* **质检结果和结论**：拒收原因及描述、质检人及其结果（质检人1和质检人2）、质检结论，提供了质检过程的结果与结论详情。
* **用户自定义及其他信息**：多个用户自定义字段（如udf1, udf2, udf3）允许根据业务需求添加额外信息；还包括冻结原因字段，记录可能导致货物被冻结的原因。
* **关联信息**：源单行号、上架行号、收货行号，关联了质检明细与其他相关业务操作的信息。



### doc_putaway_details

上架任务表（又称为：上架、上架单、上架表、上架单表、上架任务、上架明细、上架详情、putaway、putaway detail、putaway item），用来记录上架数据

主键:receipt_no(收货单号)+put_line_no(上架单行号)

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、通知单号、通知单行号、收货单号、收货单行号、上架单行号、入库单号
* **状态与包装信息**：上架单行状态、商品ID、包装相关字段（如包装ID、包装单位类型、包装计量规格、包装单位）、上架单位等，描述了货物的状态及其包装详情。
* **数量信息**：上架数量（主单位及上架单位），记录了实际上架的数量。
* **批次与跟踪信息**：批属性ID及多个批属性字段（lot01至lot15）、跟踪号ID、LPN（物流包装编号）等，提供了详细的批次跟踪能力。
* **库位与容器信息**：计划库位ID、上架库位ID、容器ID、托盘ID等，关联了具体的存储位置和使用的容器或托盘。
* **质检与冻结信息**：质检结论、冻结原因及描述、冻结数量，记录了货物的质量检查结果以及任何可能导致货物被冻结的因素。
* **操作与时间信息**：上架人员、上架时间、入库复核状态、入库复核员、入库复核时间等，记录了具体的操作细节和时间点。
* **用户自定义及其他信息**：多个用户自定义字段、打印次数、是否执行、入库复核标识、上架规则分配失败原因等，允许根据具体业务需求添加额外信息。


### doc_sc_master

抽检单主表（又称为：抽检单、样检单、sc、sc单、sc抬头），用来记录抽检单据数据

主键:sc_no(抽检单号)

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、抽检单号。
* **类型与状态信息**：抽检类型、抽检单状态，描述了抽检订单的种类及其当前的状态。
* **时间信息**：日期字段，记录了抽检订单创建的时间点。
* **参考信息**：多个参考信息字段（sc\_reference1至sc\_reference3），提供了额外的上下文或关联信息。
* **源单信息**：源单类型、源单号、源单编号以及源收货单号，将抽检订单与原始业务单据关联起来，便于追溯。
* **用户自定义字段**：多个用户自定义字段（如udf1, udf2, udf3），允许根据具体业务需求添加额外信息。
* **创建和更新信息**：创建者、建立时间、修改者、更新时间，记录了数据的创建和维护历史。
* **入库意向**：入库意向字段，可能用于指示货物在完成抽检后的处理意向。


### doc_sc_details

抽检单明细（又称为：抽检明细、抽检详情、抽检行、sc明细、sc详情、sc行、sc detail、sc item），用来记录抽检单据明细数据

主键:sc_no(抽检单号)+sc_line_no(抽检单行号)

外键2: sc_no 关联到 doc\_sc\_master.sc_no

主要核心字段有：

* **关联和主键字段**：仓库ID、货主ID、客户(供应商)ID、抽检单号、抽检单行号。
* **状态与关联信息**：行状态、源单序号、源单行号等，描述了每一条目在抽检订单中的状态及其与原始业务单据的关系。
* **位置与商品信息**：库区ID、商品ID、批属性ID、库位ID、容器ID（trace\_id）、LPN（物流包装编号），提供了关于货物存储位置和批次的详细信息。
* **数量信息**：预期数量、库存数量、应检数量、计划还货数量等，记录了与抽检相关的各种数量数据。
* **质检相关信息**：质检人1及其结果、质检结论，记录了具体的质检过程和结果。
* **冻结及其他信息**：冻结原因字段，记录可能导致货物被冻结的原因；还包括多个用户自定义字段（如udf1, udf2, udf3），允许根据具体业务需求添加额外信息。
* **创建和更新信息**：创建者、建立时间、修改者、更新时间，记录了数据的创建和维护历史。
* **操作指令与回库信息**：上架行号、收货行号、任务明细SN、出库指令号、入库指令号、是否发送INFOR、是否允许回库、源容器ID，这些字段涉及具体的操作指令以及回库的可能性。


### doc_sc_note_details

扣便条记录表（又称为：抽检损耗、抽检损耗记录、扣便条），抽检会损耗商品数量，记录质检损耗量

主要核心字段有：

* **关联和主键字段**：客户(供应商)ID、抽检单号、抽检单行号、口便条记录唯一号。
* **UPN信息**：外箱UPN、内箱UPN、还货UPN，提供了关于货物包装单位的详细信息。
* **数量信息**：库存数量、实际抽检数量、实检还货数量、便条数量，记录了与抽检及还货相关的各种数量数据。
* **状态信息**：是否扣减标记（0: 未扣减，1: 已扣减），指示了库存数量是否已经根据抽检结果进行了相应的调整。
* **用户自定义及其他信息**：多个用户自定义字段（如udf1, udf2, udf3），允许根据具体业务需求添加额外信息。
* **创建和更新信息**：创建者、建立时间、修改者、更新时间，记录了数据的创建和维护历史。